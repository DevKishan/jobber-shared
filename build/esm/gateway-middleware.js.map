{"version":3,"file":"gateway-middleware.js","names":["JWT","NotAuthorizedError","tokens","verifyGatewayRequest","req","res","next","_req$headers","headers","gatewayToken","payload","verify","includes","id","error"],"sources":["../../src/gateway-middleware.ts"],"sourcesContent":["import JWT from 'jsonwebtoken';\nimport { Request, Response, NextFunction } from 'express';\nimport { NotAuthorizedError } from './error-handler';\n\nconst tokens:string[] = [ 'auth', 'seller', 'gig', 'search', 'buyer', 'message', 'order', 'review', 'order' ];\n\nexport function verifyGatewayRequest( req:Request, res: Response, next: NextFunction ): void {\n    if ( ! req.headers?.gatewayToken ) {\n        throw new NotAuthorizedError( 'Invalid request', 'verifyGatewayRequest() method: Request coming from api gateway' );\n    }\n    \n    const gatewayToken:string = req.headers.gatewayToken as string;\n    if( ! gatewayToken ) {\n        throw new NotAuthorizedError( 'Invalid request', 'verifyGatewayRequest() method: Request coming from api gateway' );\n    }\n    \n    try {\n        const payload:JWT.JwtPayload = JWT.verify( gatewayToken, '' ) as JWT.JwtPayload;\n        if ( ! tokens.includes( payload.id ) ) {\n            throw new NotAuthorizedError( 'Invalid request', 'verifyGatewayRequest() method: Request payload is invalid' );\n        }\n    } catch (error) {\n        throw new NotAuthorizedError( 'Invalid request', 'verifyGatewayRequest() method: Request coming from api gateway' );\n    }\n}"],"mappings":"AAAA,OAAOA,GAAG,MAAM,cAAc;AAE9B,SAASC,kBAAkB,QAAQ,iBAAiB;AAEpD,MAAMC,MAAe,GAAG,CAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,OAAO,CAAE;AAE7G,OAAO,SAASC,oBAAoBA,CAAEC,GAAW,EAAEC,GAAa,EAAEC,IAAkB,EAAS;EAAA,IAAAC,YAAA;EACzF,IAAK,GAAAA,YAAA,GAAEH,GAAG,CAACI,OAAO,aAAXD,YAAA,CAAaE,YAAY,GAAG;IAC/B,MAAM,IAAIR,kBAAkB,CAAE,iBAAiB,EAAE,gEAAiE,CAAC;EACvH;EAEA,MAAMQ,YAAmB,GAAGL,GAAG,CAACI,OAAO,CAACC,YAAsB;EAC9D,IAAI,CAAEA,YAAY,EAAG;IACjB,MAAM,IAAIR,kBAAkB,CAAE,iBAAiB,EAAE,gEAAiE,CAAC;EACvH;EAEA,IAAI;IACA,MAAMS,OAAsB,GAAGV,GAAG,CAACW,MAAM,CAAEF,YAAY,EAAE,EAAG,CAAmB;IAC/E,IAAK,CAAEP,MAAM,CAACU,QAAQ,CAAEF,OAAO,CAACG,EAAG,CAAC,EAAG;MACnC,MAAM,IAAIZ,kBAAkB,CAAE,iBAAiB,EAAE,2DAA4D,CAAC;IAClH;EACJ,CAAC,CAAC,OAAOa,KAAK,EAAE;IACZ,MAAM,IAAIb,kBAAkB,CAAE,iBAAiB,EAAE,gEAAiE,CAAC;EACvH;AACJ","ignoreList":[]}